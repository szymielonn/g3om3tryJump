<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<title>Geometry Jump - Stereo Madness X</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
  body {
    margin: 0; 
    background: linear-gradient(90deg, #141e30, #243b55);
    overflow: hidden;
    display: flex; 
    justify-content: center; 
    align-items: center; 
    height: 100vh;
    font-family: 'Orbitron', monospace;
    user-select: none;
  }
  canvas {
    background: #0a0a0a;
    border: 4px solid #00fff7;
    box-shadow: 0 0 15px #00fff7;
    display: block;
  }
  #score {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: #00fff7;
    font-size: 24px;
    text-shadow: 0 0 8px #00fff7;
    letter-spacing: 2px;
    user-select: none;
    z-index: 10;
  }
  #message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #ff0055;
    font-size: 36px;
    font-weight: 900;
    text-shadow: 0 0 10px #ff0055;
    user-select: none;
    display: none;
    z-index: 20;
  }
  #restartBtn {
    position: fixed;
    top: 60%;
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 25px;
    font-size: 20px;
    font-weight: 700;
    color: #0a0a0a;
    background: #00fff7;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 0 10px #00fff7;
    display: none;
    user-select: none;
    z-index: 20;
    transition: background 0.3s ease;
  }
  #restartBtn:hover {
    background: #00c8c0;
  }
</style>
</head>
<body>

<div id="score">Distance: 0m</div>
<div id="message">YOU WIN! ðŸŽ‰</div>
<button id="restartBtn">Restart</button>

<canvas id="game" width="800" height="200"></canvas>

<script>
// SETTINGS
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const GRAVITY = 0.8;
const JUMP_POWER = -14;
const SPEED = 5;
const PLAYER_SIZE = 25;

const FLY_POWER = -8; // siÅ‚a latania (do sterowania w powietrzu)
const MAX_FLY_TIME = 60; // max klatek latania

// PLAYER
const player = {
  x: 50,
  y: canvas.height - PLAYER_SIZE,
  width: PLAYER_SIZE,
  height: PLAYER_SIZE,
  vy: 0,
  grounded: true,
  flying: false,
  flyTime: 0
};

// OBSTACLES - jak w Stereo Madness
const obstacles = [
  {x: 220, y: canvas.height - 30, width: 20, height: 30, type: 'spike'},
  {x: 320, y: canvas.height - 60, width: 40, height: 60, type: 'platform'},
  {x: 420, y: canvas.height - 30, width: 20, height: 30, type: 'spike'},
  {x: 500, y: canvas.height - 80, width: 40, height: 80, type: 'platform'},
  // Start sekcji latania - tam gdzie w stereo madness lecisz
  {x: 580, y: canvas.height - 100, width: 40, height: 80, type: 'platform'},
  {x: 650, y: canvas.height - 120, width: 30, height: 60, type: 'platform'},
  {x: 710, y: canvas.height - 140, width: 40, height: 40, type: 'platform'},
  // koniec sekcji latania
  {x: 780, y: canvas.height - 30, width: 20, height: 30, type: 'spike'},

  // Åšciana na koÅ„cu do wygrania
  {x: 840, y: 0, width: 20, height: canvas.height, type: 'endwall'}
];

let offsetX = 0;
let gameOver = false;
let distance = 0;
let gameWin = false;

const scoreDisplay = document.getElementById('score');
const message = document.getElementById('message');
const restartBtn = document.getElementById('restartBtn');

function resetGame() {
  offsetX = 0;
  distance = 0;
  player.y = canvas.height - PLAYER_SIZE;
  player.vy = 0;
  player.grounded = true;
  player.flying = false;
  player.flyTime = 0;
  gameOver = false;
  gameWin = false;
  message.textContent = '';
  message.style.display = 'none';
  restartBtn.style.display = 'none';
  scoreDisplay.textContent = 'Distance: 0m';
  requestAnimationFrame(gameLoop);
}

// INPUT
const keys = {};
window.addEventListener('keydown', e => {
  keys[e.code] = true;
  if (gameOver || gameWin) return;
  if ((e.code === 'Space' || e.code === 'ArrowUp')) {
    if (player.grounded) {
      player.vy = JUMP_POWER;
      player.grounded = false;
      player.flying = false;
      player.flyTime = 0;
    } else if (!player.grounded && player.flyTime < MAX_FLY_TIME) {
      player.flying = true;
    }
  }
});

window.addEventListener('keyup', e => {
  keys[e.code] = false;
  if (e.code === 'Space' || e.code === 'ArrowUp') {
    player.flying = false;
  }
});

restartBtn.addEventListener('click', () => {
  resetGame();
});

// HELPERS
function drawSpike(x, y, width, height) {
  ctx.fillStyle = '#ff0044';
  ctx.beginPath();
  ctx.moveTo(x, y + height);
  ctx.lineTo(x + width / 2, y);
  ctx.lineTo(x + width, y + height);
  ctx.closePath();
  ctx.fill();
}

function drawPlatform(x, y, width, height) {
  ctx.fillStyle = '#00fff7';
  ctx.fillRect(x, y, width, height);
}

function drawEndWall(x, y, width, height) {
  ctx.fillStyle = '#ffaa00';
  ctx.shadowColor = '#ffaa00';
  ctx.shadowBlur = 20;
  ctx.fillRect(x, y, width, height);
  ctx.shadowBlur = 0;
}

// COLLISION DETECTION
function rectCollision(r1, r2) {
  return !(r2.x > r1.x + r1.width ||
           r2.x + r2.width < r1.x ||
           r2.y > r1.y + r1.height ||
           r2.y + r2.height < r1.y);
}

function gameLoop() {
  if (gameOver || gameWin) return;

  // PHYSICS
  if (player.flying && player.flyTime < MAX_FLY_TIME) {
    player.vy = FLY_POWER;
    player.flyTime++;
  } else {
    player.vy += GRAVITY;
  }
  player.y += player.vy;

  // FLOOR collision
  if (player.y + player.height >= canvas.height) {
    player.y = canvas.height - player.height;
    player.vy = 0;
    player.grounded = true;
    player.flying = false;
    player.flyTime = 0;
  } else {
    player.grounded = false;
  }

  // SCROLLING
  offsetX += SPEED;
  distance = Math.floor(offsetX / 10);
  scoreDisplay.textContent = `Distance: ${distance}m`;

  // CLEAR
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // DRAW PLAYER neon square
  ctx.fillStyle = '#00fff7';
  ctx.shadowColor = '#00fff7';
  ctx.shadowBlur = 15;
  ctx.fillRect(player.x, player.y, player.width, player.height);
  ctx.shadowBlur = 0;

  // DRAW OBSTACLES
  let landedOnPlatform = false;
  for (let obs of obstacles) {
    let obsX = obs.x - offsetX;

    if (obsX + obs.width < 0) continue; // skip off screen left
    if (obsX > canvas.width) continue;  // skip off screen right

    if (obs.type === 'spike') {
      drawSpike(obsX, obs.y, obs.width, obs.height);
    } else if (obs.type === 'platform') {
      drawPlatform(obsX, obs.y, obs.width, obs.height);
    } else if (obs.type === 'endwall') {
      drawEndWall(obsX, obs.y, obs.width, obs.height);
    }

    // Collision with spikes = game over
    if (obs.type === 'spike' && rectCollision(player, {x: obsX, y: obs.y, width: obs.width, height: obs.height})) {
      gameOver = true;
      endGame(false);
    }

    // Collision with endwall = WIN
    if (obs.type === 'endwall' && rectCollision(player, {x: obsX, y: obs.y, width: obs.width, height: obs.height})) {
      gameWin = true;
      endGame(true);
    }

    // Landing on platform
    if (obs.type === 'platform') {
      let playerBottom = player.y + player.height;
      let obsTop = obs.y;
      if (player.x + player.width > obsX &&
          player.x < obsX + obs.width &&
          playerBottom <= obsTop + 10 &&
          playerBottom + player.vy >= obsTop) {
        player.y = obsTop - player.height;
        player.vy = 0;
        player.grounded = true;
        player.flying = false;
        player.flyTime = 0;
        landedOnPlatform = true;
      }
    }
  }

  if (!landedOnPlatform && player.y + player.height < canvas.height) {
    player.grounded = false;
  }

  requestAnimationFrame(gameLoop);
}

function endGame(won) {
  if (won) {
    message.textContent = 'YOU WIN! ðŸŽ‰';
    message.style.color = '#00ff44';
    message.style.textShadow = '0 0 20px #00ff44';
  } else {
    message.textContent = 'GAME OVER';
    message.style.color = '#ff0055';
    message.style.textShadow = '0 0 10px #ff0055';
  }
  message.style.display = 'block';
  restartBtn.style.display = 'block';
}

// Start game
resetGame();
</script>

</body>
</html>
